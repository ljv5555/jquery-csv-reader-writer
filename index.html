<!doctype html>
<html>
<head>
    <style>
    body,body *{font-family:courier new !important;};
    .out{height:100px;border:1px solid #ccc;border-radius:5px;}
.out > table > td, .out > table > th{border:1px solid silver;}
div{margin:5px;padding:5px;}
*{border-radius:4px;}
input,textarea{border:0px solid white;margin:5px 5px;padding:5px 5px;}
.ht1 td{vertical-align:bottom;}.ht1{ width:100%;}
.rotd,.cotd{border:solid 1px #ccc;padding:5px;}
button{border:0px solid white;margin:5px 5px;padding:5px 5px;}
button{border:1px solid #ccc;}
.out tr{background:#ccc;}
.out tr:nth-of-type(even){background:#ddd;}
.out td{background:#eee;padding:4px 4px 4px 4px;}
#ta1{margin:20px 5% 20px 5%;width:90%;height:80px;}
.wddb{min-width: 99%;background:#ba9;display:table;}
.sw{background-color:rgba(100,100,100,0.25);}
.activecell_row{background:rgba(0,250,250,0.45) !important;}
.activecell_column{background:rgba(0,250,250,0.45) !important;}
.activecell{background:rgba(0,250,250,0.45) !important;}

    </style>

<script src="jquery.min.js"></script>
<script src="jquery-csv.js"></script>

<script id="csv_js">
   
/**
  * jQuery CSV Editor plugin
  * License - Copyright(C) 2014 Louis J Verdertber IV. All rights reserved.
  * Includes jquery-csv (https://code.google.com/p/jquery-csv/) under the terms of the MIT license.
  **/

window.init1=function(){
    // hide button if in top frame
    if(window.top.location.href===window.location.href){$('#btf').hide();}
    // load csv_js
    /*eval($('#csv_js').val());   */
    // alredy defined: $.csv2Array(csvstring)
    $.csv2array=function(csv)
    {
    	if(csv && csv.length!==0 && csv[csv.length-1]!='\n'){csv+='\n';}
    	return $.csv2Array(csv);
    };
    $.array2csv=function(d){var r = '';
        for(var i=0;d && d.length && i<d.length;i++){
            if(i!=0){r+='\n';} 
            var row = d[i]; 
            for(var j=0;j<row.length;j++){
                if(j!=0){r+=",";}
                r+='"'+(row[j]+'').replace(/\"/g,'\"\"')+'"';
            }
        }
        return r;
    }

    $.updateAndGetHtmlTableActiveCellAndRowCellsAndColumnCells=function(table)
    {
    	var jqtable = table;
    	if(!table.slideDown){jqtable = $(d);}
    	
    	var ac = jqtable.find('.activecell');
    	var aci = $.getHtmlTableActiveCell(jqtable);
    	var acrowi = aci[0]==-1?0:aci[0];
    	var accoli = aci[1]==-1?0:aci[1];
    	var acrow = jqtable.find('tr:nth-child('+(acrowi+1)+')');
    	var acrowcells = acrow.find('td,th');
    	var accolcells = jqtable.find('td:nth-child('+(accoli+1)+')');
    	jqtable.find('*').removeClass('activecell').removeClass('activecell_column').removeClass('activecell_row');
    	acrowcells.addClass('activecell_row');
    	accolcells.addClass('activecell_column');
    	ac.addClass('activecell');
    	return [ac,acrowcells,accolcells];
    };
    
    
    $.array2htmlTable=function(d,selectedrowindex,selectedcolumnindex){
        if(selectedrowindex!==0){if(!selectedrowindex){selectedrowindex=0;}}
        if(selectedcolumnindex!==0){if(!selectedcolumnindex){selectedcolumnindex=0;}}
        var jqtable = $('<table/>');
        for(var i=0;d && d.length && i<d.length;i++){
            var row=d[i];
            var tr = $('<tr/>');
            for(var j=0;j<row.length;j++){
                var val = row[j]+'';
                var td = $('<td/>').attr('contenteditable',"true");
                if(i==selectedrowindex && j==selectedcolumnindex){td.addClass('activecell');}
                td.text(val);
                tr.append(td);
            }
            jqtable.append(tr);
        }
        if(jqtable.find('.activecell').length === 0){jqtable.find('td,th').first().addClass('activecell');}
        return jqtable[0];
    };
    $.getHtmlTableActiveCell=function(d){
    	var rtn = [-1,-1];
    	if(!d){d=$('.out table');}
    	var jqtable = d;
    	if(!d.slideDown){jqtable = $(d);}
    	jqtable.find('tr').each(function(i,e){
    		$(e).find('td,th').each(function(i2,e2){
    			if($(e2).hasClass('activecell')){rtn=[i,i2];}
    		});
    	});
    	return rtn;

    };
    $.setHtmlTableActiveCell=function(d,selectedrowindex,selectedcolumnindex){
    	if(selectedrowindex!==0){if(!selectedrowindex){selectedrowindex=0;}}
        if(selectedcolumnindex!==0){if(!selectedcolumnindex){selectedcolumnindex=0;}}
        if(!d){d=$('.out table');}
        var jqtable = d;
    	if(!d.slideDown){jqtable = $(d);}
    	jqtable.find('.activecell').removeClass('activecell');
    	jqtable.find('tr').each(function(i,e){
    		$(e).find('td,th').each(function(i2,e2){
    			if(i2==selectedcolumnindex && i==selectedrowindex){$(e2).addClass('activecell');}
    		});
    	});
    	if(jqtable.find('.activecell').length === 0){jqtable.find('td,th').first().addClass('activecell');}
    	jqtable.find('td,th').on('focus',function(a,b,c){console.log([a,b,c]);});
    	return jqtable.html();
    };

    $.htmlTable2array=function(tableElement)
    {
        var rtn = [];
        if(typeof(tableElement)==='string'){tableElement=$(tableElement)[0];}
        if(tableElement && (tableElement.fadeIn?true:false)){tableElement=tableElement[0];}
        var tw = $('<div/>');
        var tw1 = $('<div class="wdiv1"/>');
        tw1.append(tableElement);
        tw.append(tw1);
	var key1=function(){return 'html2csv2html';};
        var trows = tw.find('div.wdiv1>table>tr,div.wdiv1>table>*>tr');
        trows.each(function(i,e){
            var rtnr = [];
            var trow=$(e);
            var tcells=trow.children('td,th');
            tcells.each(function(i2,e2){rtnr.push(''+$(e2).text());});
            rtn.push(rtnr);            
        });
	key1();
        return rtn;
    }
    
    $.htmlTable2csv = function(i){return $.array2csv($.htmlTable2array(i));};
    $.csv2htmlTable = function(i){return $.array2htmlTable($.csv2array(i));};
    
    window.addRemoveRowColumn = function(button){
    	var table = $('.out table');
    	if(table.find('td,th').length==0){return;}
    	var ac = $('.activecell');
    	var aci = $.getHtmlTableActiveCell();
    	var acrowi = aci[0]==-1?0:aci[0];
    	var accoli = aci[1]==-1?0:aci[1];
    	var acrow = table.find('tr:nth-child('+(acrowi+1)+')');
    	var acrowcells = acrow.find('td,th');
    	var accolcells = table.find('td:nth-child('+(accoli+1)+')');
    	
    		
    	if(button=="ira"){
    		acrow.after($('<tr/>').html(acrow.html()));
    	}
    	else if(button=="irb"){
    		acrow.before($('<tr/>').html(acrow.html()));
    	}
    	else if(button=="dr"){
    		acrow.remove();	
    	}
    	else if(button=="ica"){
    		accolcells.each(function(i,e){$(e).after($('<td contenteditable="contenteditable"/>').html($(e).html()));});
    	}
    	else if(button=="icb"){
    		accolcells.each(function(i,e){$(e).before($('<td contenteditable="contenteditable"/>').html($(e).html()));});
    	}
    	else if(button=="dc"){
    		accolcells.remove();
    	}
    	$.setHtmlTableActiveCell(table);
    	
    };
    
    
};
jQuery(function(){window.init1();});

    
</script>
</head><body>

<div class="wddb">
    <button style="text-align:right"
    id="btf" type="button" 
    onclick="window.top.location.href=window.location.href;">Load frame in top window</button>
    <div></div><div></div>
    <div class="sw">
        <div>CSV Text: </div>
        <div>
<textarea id="ta1">a,b,c
c1v,"a string with ""quotes"", and a comma",colum3value
</textarea>
        </div>
    </div>
    <button id="b2" type="button" onclick="$('.out').html($.csv2htmlTable($('#ta1').val()));">CSV Text - - &gt; Editor</button>
    <button id="b3" type="button" onclick="$('#ta1').val($.htmlTable2csv($('.out').html()));">Editor - - &gt; CSV Text</button>    

    
    

<div class="wddb">
    <div class="sw">
        <table class="ht1"><tr><td class="etd">Editor:</td>
            <td class="rotd">Row Operations:<br/>
                <button id="irb" type="button" onclick="window.addRemoveRowColumn(this.id);">insert before</button>    
                <br/><button id="ira" type="button" onclick="window.addRemoveRowColumn(thi.ids);">insert after</button>
                <br/><button id="dr" type="button" onclick="window.addRemoveRowColumn(this.id);">delete</button>

            </td>
            <td class="cotd">Column Operations:<br/>
                <button id="icb" type="button" onclick="window.addRemoveRowColumn(this.id);">insert before</button>    
                <br/><button id="ica" type="button" onclick="window.addRemoveRowColumn(this.id);">insert after</button>
                <br/><button id="dc" type="button" onclick="window.addRemoveRowColumn(this.id);">delete</button>

            </td>
            </tr>
            <tr><td><div class="out"></div></td></tr>
            </table>
    </div>
</div>

</div>


</body></html>
