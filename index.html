<!doctype html>
<html>
<head>
    <style>
    .out{height:100px;border:1px solid #ccc;border-radius:5px;}
.out > table > td, .out > table > th{border:1px solid silver;}
div{margin:5px;padding:5px;}
*{border-radius:4px;}
input,textarea{border:0px solid white;margin:5px 5px;padding:5px 5px;}
.ht1 td{vertical-align:bottom;}.ht1{ width:100%;}
.rotd,.cotd{border:solid 1px #ccc;padding:5px;}
button{border:0px solid white;margin:5px 5px;padding:5px 5px;}
button{border:1px solid #ccc;}
.out tr{background:#ccc;}
.out tr:nth-of-type(even){background:#ddd;}
.out td{background:#eee;padding:4px 4px 4px 4px;}

    </style>

<script src="jquery.min.js"></script>
<script src="jquery-csv.js"></script>

<script id="csv_js">
   
/**
  * jQuery CSV Editor plugin
  * License - Copyright(C) 2014 Louis J Verdertber IV. All rights reserved.
  * Includes jquery-csv (https://code.google.com/p/jquery-csv/) under the terms of the MIT license.
  **/

window.init1=function(){
    // hide button if in top frame
    if(window.top.location.href===window.location.href){$('#btf').hide();}
    // load csv_js
    /*eval($('#csv_js').val());   */
    // alredy defined: $.csv2Array(csvstring)
    $.csv2array=$.csv2Array;
    $.array2csv=function(d){var r = '';
        for(var i=0;i<d.length;i++){
            if(i!=0){r+='\n';} 
            var row = d[i]; 
            for(var j=0;j<row.length;j++){
                if(j!=0){r+=",";}
                r+='"'+(row[j]+'').replace(/\"/g,'\"\"')+'"';
            }
        }
        return r;
    }

    
    
    
    $.array2htmlTable=function(d,selectedrowindex,selectedcolumniudex){
        if(selectedrowindex!==0){if(!selectedrowindex){selectedrowindex=0;}}
        if(selectedcolumnindex!==0){if(!selectedcolumnindex){selectedcolumnindex=0;}}
        var jqtable = $('<table/>');
        for(var i=0;i<d.length;i++){
            var row=d[i];
            var tr = $('<tr/>');
            for(var j=0;j<row.length;j++){
                var val = row[j]+'';
                var td = $('<td/>').attr('contenteditable',"true");
                if(i==selectedrowindex && j==selectedcolumnindex){td.addClass('activecell');}
                td.text(val);
                tr.append(td);
            }
            jqtable.append(tr);
        }
        if(jqtable.find('.activecell').length === 0){jqtable.find('td').first().addClass('activecell');}
        return jqtable[0];
    }
    $.getHtmlTableActiveCell=function(d){
    	var rtn = [-1,-1];
    	var jqtable = d;
    	if(!d.slideDown){jqtable = $(d);}
    	var rows = jqtable.find('tr');
    	for(var j=0;j<rows.length;j++)
    	{
    		var row = $(rows[j]);
    		var cells = row.children('tr,th');
    		for(var k=0;k<cells.length;k++)
    		{
    			console.log(cells[k]);
    			console.log('hasclass='+$(cells[k]).hasClass('activecell'));
    			if($(cells[k]).hasClass('activecell')){rtn=[j,k];break;}
    		}
    	}
    	return rtn;

    };

    $.htmlTable2array=function(tableElement)
    {
        var rtn = [];
        if(typeof(tableElement)==='string'){tableElement=$(tableElement)[0];}
        if(tableElement && (tableElement.fadeIn?true:false)){tableElement=tableElement[0];}
        var tw = $('<div/>');
        var tw1 = $('<div class="wdiv1"/>');
        tw1.append(tableElement);
        tw.append(tw1);
	var key1=function(){return 'html2csv2html';};
        var trows = tw.find('div.wdiv1>table>tr,div.wdiv1>table>*>tr');
        trows.each(function(i,e){
            var rtnr = [];
            var trow=$(e);
            var tcells=trow.children('td,th');
            tcells.each(function(i2,e2){rtnr.push(''+$(e2).text());});
            rtn.push(rtnr);            
        });
	key1();
        return rtn;
    }
    
    $.htmlTable2csv = function(i){return $.array2csv($.htmlTable2array(i));};
    $.csv2htmlTable = function(i){return $.array2htmlTable($.csv2array(i));};
    
    window.addRemoveRowColumn = function(button){
    	if(button=="ira"){
    		
    	}
    	else if(button=="irb"){
    		
    	}
    	else if(button=="irb"){
    		
    	}
    	else if(button=="dr"){
    		
    	}
    	else if(button=="icb"){
    		
    	}
    	else if(button=="dcb"){
    		
    	}
    	else if(button=="dc"){
    		
    	}
    	
    };
    
    
};
jQuery(function(){window.init1();});

    
</script>
</head><body>

<div style="border:1px solid #ddd;">
    <button style="text-align:right"
    id="btf" type="button" 
    onclick="window.top.location.href=window.location.href;">Load frame in top window</button>
    <div></div><div></div>
    <div style="background:#ba9;">
        <div>CSV Text: </div><div>
        <textarea id="ta1">a,b,c
c1v,"a string with ""quotes"", and a comma",colum3value
        </textarea></div>
    </div>
    <button id="b2" type="button" onclick="$('.out').html($.csv2htmlTable($('#ta1').val()));">CSV Text - - &gt; Editor</button>
    <button id="b3" type="button" onclick="$('#ta1').val($.htmlTable2csv($('.out').html()));">Editor - - &gt; CSV Text</button>    

    
    

<div style="background:#ba9;">
    <div>
        <table class="ht1"><tr><td class="etd">Editor:</td>
            <td class="rotd">Row Operations:<br/>
                <button id="irb" type="button" onclick="window.addRemoveRowColumn(this);">insert before</button>    
                <br/><button id="ira" type="button" onclick="window.addRemoveRowColumn(this);">insert after</button>
                <br/><button id="dr" type="button" onclick="window.addRemoveRowColumn(this);">delete</button>

            </td>
            <td class="cotd">Column Operations:<br/>
                <button id="icb" type="button" onclick="window.addRemoveRowColumn(this);">insert before</button>    
                <br/><button id="ica" type="button" onclick="window.addRemoveRowColumn(this);">insert after</button>
                <br/><button id="dc" type="button" onclick="window.addRemoveRowColumn(this);">delete</button>

            </td>
            </tr></table>
    </div>
<div class="out" editable="editable"></div>
</div>

</div>


</body></html>
